# RUN: llc -mtriple=mos6502 -run-pass=prologepilog -verify-machineinstrs -o - %s | FileCheck %s
---
name: stack
# CHECK-LABEL: name: stack
stack:
  - { id: 0, size: 32}
  - { id: 1, size: 32}
  - { id: 2, size: 1}
  - { id: 3, size: 1}
  - { id: 4, size: 1}
  - { id: 5, size: 1}
body:             |
  bb.0.entry:
    SThs $a, %stack.2 :: (store 1 into %stack.2)
    $a = AddFiLo %stack.0, implicit-def $c, implicit-def $nz, implicit $sp
    $a = AdcFiHi %stack.1, implicit-def $c, implicit-def $nz, implicit $sp, implicit $c
    SThs $a, %stack.4 :: (store 1 into %stack.4)
    SThs $a, %stack.3 :: (store 1 into %stack.3)
    $a = LDhs %stack.3 :: (load 1 from %stack.3)
    $a = LDhs %stack.4 :: (load 1 from %stack.4)
    $a = LDhs %stack.2 :: (load 1 from %stack.2)
    RTS
# CHECK-LABEL: bb.0.entry:
# CHECK-NEXT:  IncSP -64
# CHECK-NEXT:  PHA implicit $a
# CHECK-NEXT:  $a = AddFiLo 32
# CHECK-NEXT:  $a = AdcFiHi 0
# CHECK-NEXT:  PHA implicit undef $a
# CHECK-NEXT:  PHA implicit $a
# CHECK-NEXT:  PHA implicit undef $a
# CHECK-NEXT:  SThs $a, 3
# CHECK-NEXT:  $a = LDhs 3
# CHECK-NEXT:  PLA implicit-def dead $a
# CHECK-NEXT:  PLA implicit-def $a
# CHECK-NEXT:  PLA implicit-def dead $a
# CHECK-NEXT:  PLA implicit-def $a
# CHECK-NEXT:  IncSP 64
# CHECK-NEXT:  RTS
...
---
name: epilogue_save_a
# CHECK-LABEL: name: epilogue_save_a
stack:
  - { id: 0, size: 1}
body:             |
  bb.0.entry:
    $a = IMPLICIT_DEF
    RTS implicit $a
# CHECK-LABEL: bb.0.entry:
# CHECK-NEXT:  $a = IMPLICIT_DEF
# CHECK-NEXT:  PHA
# CHECK-NEXT:  $zp_0 = STzpr $a
# CHECK-NEXT:  PLA
# CHECK-NEXT:  $a = LDzpr $zp_0
# CHECK-NEXT:  RTS
...
---
name: epilogue_no_terminator
# CHECK-LABEL: name: epilogue_no_terminator
frameInfo:
  savePoint: '%bb.0.entry'
  restorePoint: '%bb.0.entry'
stack:
  - { id: 0, size: 1}
tracksRegLiveness: true
body:             |
  bb.0.entry:
    $a = IMPLICIT_DEF

  bb.1:
    RTS
# CHECK-LABEL: bb.0.entry:
# CHECK:       $a = IMPLICIT_DEF
# CHECK-NEXT:  PHA
# CHECK-NEXT:  PLA
...
