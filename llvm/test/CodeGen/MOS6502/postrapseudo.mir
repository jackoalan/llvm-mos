# RUN: llc -mtriple=mos6502 -run-pass=postrapseudos -verify-machineinstrs -o - %s | FileCheck %s
---
name: addfilo
# CHECK-LABEL: name: addfilo
body: |
  bb.0.entry:
    $a = AddFiLo 1234, implicit-def $c, implicit-def $nz, implicit $sp
# CHECK:      $a = LDimm 210
# CHECK-NEXT: LDCimm 0
# CHECK-NEXT: $a = ADCzp $a, &_SPlo
...
---
name: addfilo0
# CHECK-LABEL: name: addfilo0
body: |
  bb.0.entry:
    $a = AddFiLo 512, implicit-def $c, implicit-def $nz, implicit $sp
# CHECK: $a = LDzp &_SPlo
...
---
name: addfilo_copy
# CHECK-LABEL: name: addfilo_copy
body: |
  bb.0.entry:
    $zp_1 = AddFiLo 512, implicit-def $c, implicit-def $nz, implicit $sp
# CHECK:      $a = LDzp &_SPlo
# CHECK-NEXT: STzp &_ZP_1, $a
...
---
name: adcfihi
# CHECK-LABEL: name: adcfihi
body: |
  bb.0.entry:
    $a = AdcFiHi 1234, implicit-def $c, implicit-def $nz, implicit $c, implicit $sp
# CHECK:      $a = LDimm 4
# CHECK-NEXT: $a = ADCzp $a, &_SPhi
...
---
name: adcfihi_lo0
# CHECK-LABEL: name: adcfihi
body: |
  bb.0.entry:
    $a = AdcFiHi 512, implicit-def $c, implicit-def $nz, implicit $c, implicit $sp
# CHECK:      $a = LDimm 2
# CHECK-NEXT: LDCimm 0
# CHECK-NEXT: $a = ADCzp $a, &_SPhi
...
---
name: incsp
# CHECK-LABEL: name: incsp
body: |
  bb.0.entry:
    IncSP -1234, implicit-def $sp, implicit $sp
    RTS implicit $c
# CHECK:      PHP
# CHECK-NEXT: LDCimm 0
# CHECK-NEXT: $a = LDimm 46
# CHECK-NEXT: $a = ADCzp $a, &_SPlo
# CHECK-NEXT: STzp &_SPlo, $a
# CHECK-NEXT: $a = LDimm 251
# CHECK-NEXT: $a = ADCzp $a, &_SPhi
# CHECK-NEXT: STzp &_SPhi, $a
# CHECK-NEXT: PLP
...
---
name: incsp_hi_only
# CHECK-LABEL: name: incsp
body: |
  bb.0.entry:
    IncSP -512, implicit-def $sp, implicit $sp
    RTS
# CHECK:      LDCimm 0
# CHECK-NEXT: $a = LDimm 254
# CHECK-NEXT: $a = ADCzp $a, &_SPhi
# CHECK-NEXT: STzp &_SPhi, $a
...
---
name: ldaidx
# CHECK-LABEL: name: ldaidx
body: |
  bb.0.entry:
    liveins: $x
    $a = LDidx 1234, $x, implicit-def $nz
# CHECK: LDAidx 1234, $x
...
---
name: ldxidx_y
# CHECK-LABEL: name: ldxidx_y
body: |
  bb.0.entry:
    liveins: $y
    $x = LDidx 1234, $y, implicit-def $nz
# CHECK: LDXidx 1234
...
---
name: ldxidx_x
# CHECK-LABEL: name: ldxidx_x
body: |
  bb.0.entry:
    liveins: $x
    $x = LDidx 1234, $x, implicit-def $nz
    CMPimm $a, 0, implicit-def $nz
# CHECK:      PHA
# CHECK-NEXT: LDAidx 1234, $x
# CHECK-NEXT: $x = TA_
# CHECK-NEXT: PLA
...
---
name: ldyidx_x
# CHECK-LABEL: name: ldyidx_x
body: |
  bb.0.entry:
    liveins: $x
    $y = LDidx 1234, $x, implicit-def $nz
# CHECK: LDYidx 1234
...
---
name: ldhs
# CHECK-LABEL: name: ldhs
body: |
  bb.0.entry:
    $x = LDhs 2
# CHECK:      TSX
# CHECK-NEXT: LDAidx 258, $x
# CHECK-NEXT: $x = TA_
...
---
name: sths
# CHECK-LABEL: name: sths
body: |
  bb.0.entry:
    SThs $x, 2
# CHECK:      STzp &_ZP_0, $x
# CHECK-NEXT: T_A $x
# CHECK-NEXT: TSX
# CHECK-NEXT: STAidx 258, $x
# CHECK-NEXT: $x = LDzp &_ZP_0
...
